# v1.4.0 PyO3 + VENV 検証結果

## 概要

v1.4.0 では外部 Python ライブラリ呼び出しに **PythonBridge（常駐プロセス方式）** を使用している。
この方式と PyO3 直接呼び出し方式の比較検証を行った。

## 検証結果

### PythonBridge 方式（採用）

| 項目 | 状態 |
|------|------|
| venv 環境対応 | ✅ 正常動作 |
| パッケージ解決 | ✅ `importlib.import_module` を使用 |
| GIL 問題 | ✅ 回避（別プロセス） |
| Python バージョン | ✅ システム Python に依存しない |

**動作確認コマンド**:
```bash
source venv/bin/activate
cargo run --bin tnk -- examples/import/v1_2_numpy_simple.py --project ./output
cd output && cargo run --release
```

### PyO3 方式（参考）

| 項目 | 状態 |
|------|------|
| venv 環境対応 | ⚠️ 環境変数設定が必要な場合あり |
| パッケージ解決 | ⚠️ システム Python を参照する場合あり |
| GIL 問題 | ⚠️ マルチスレッド時に注意 |
| Python バージョン | ⚠️ ビルド時の Python バージョンに依存 |

PyO3 は `pyo3-build-config` でビルド時の Python が決定されるため、
venv 環境のライブラリを使用するには追加の設定が必要。

## 結論

**PythonBridge 方式を継続採用**

理由:
1. venv 環境との親和性が高い
2. GIL の制約を受けない
3. Python バージョンに柔軟に対応
4. エンドユーザーが venv を activate するだけで動作

## 推奨ワークフロー

```bash
# 1. venv 環境を有効化
source venv/bin/activate

# 2. 必要なライブラリをインストール
pip install numpy pandas opencv-python-headless

# 3. トランスパイル & 実行
tnk input.py --project ./output
cd output && cargo run --release
```
